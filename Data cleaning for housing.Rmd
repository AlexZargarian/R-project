---
title: "Data cleaning for housing"
author: "Alex Zargarian"
date: "2025-07-24"
output: html_document
---

# Housing Data Cleaning and Combination

This project combines Airbnb data with Armenian flats data and removes duplicates.

## Setup and Library Loading

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r load-libraries}
library(readr)
library(dplyr)
library(stringr)
library(tidyr)
library(here)

```

## Data Loading

```{r define-paths}

file_path= "/Users/alex/Desktop/R-project/Data used/House Price/part-00295-e039244b-cf18-4c20-a539-6e32f86875aa.c000.csv"


original_data= read_csv(file_path)

cat("Original dataset dimensions:", dim(original_data), "\n")
cat("Column names:\n")
colnames(original_data)
```




```{r}

cat("First few rows to understand the data:\n")
head(original_data, 3) %>% glimpse()

cat("\nChecking for location information in listing names or other fields:\n")
cat("Sample listing names:\n")
head(original_data$listing_name, 10)
```


```{r}
cleaned_data = original_data %>%
  select(
    listing_id,
    listing_name,
    listing_type,
    room_type,
    
    # Host information
    host_id,
    host_name,
    superhost,
    
    # Location information (coordinates only since no city column)
    latitude,
    longitude,
    
    # Property characteristics
    guests,
    bedrooms,
    beds,
    baths,
    amenities,
    
    # Booking information
    instant_book,
    min_nights,
    cancellation_policy,
    
    # Pricing information
    cleaning_fee,
    extra_guest_fee,
    
    # Review and rating information
    num_reviews,
    rating_overall,
    rating_cleanliness,
    rating_location,
    rating_value,
    
    # Revenue metrics (Trailing Twelve Months)
    ttm_revenue,
    ttm_avg_rate,
    ttm_occupancy,
    ttm_revpar,
    
    # Recent performance metrics (Last 90 Days)
    l90d_revenue,
    l90d_avg_rate,
    l90d_occupancy,
    l90d_revpar
  )

cat("Cleaned dataset dimensions:", dim(cleaned_data), "\n")
```


```{r}
cleaned_data= cleaned_data %>%
  mutate(
    listing_type = str_to_lower(str_trim(listing_type)),
    room_type = str_to_lower(str_trim(room_type)),
    cancellation_policy = str_to_lower(str_trim(cancellation_policy)),
    
    superhost = case_when(
      superhost == TRUE | superhost == "true" | superhost == 1 ~ TRUE,
      superhost == FALSE | superhost == "false" | superhost == 0 ~ FALSE,
      TRUE ~ NA
    ),
    
    instant_book = case_when(
      instant_book == TRUE | instant_book == "true" | instant_book == 1 ~ TRUE,
      instant_book == FALSE | instant_book == "false" | instant_book == 0 ~ FALSE,
      TRUE ~ NA
    ),
    
    guests = as.numeric(guests),
    bedrooms = as.numeric(bedrooms),
    beds = as.numeric(beds),
    baths = as.numeric(baths),
    cleaning_fee = as.numeric(cleaning_fee),
    extra_guest_fee = as.numeric(extra_guest_fee),
    num_reviews = as.numeric(num_reviews),
    min_nights = as.numeric(min_nights),
    
    rating_overall = case_when(
      rating_overall >= 0 & rating_overall <= 5 ~ rating_overall,
      TRUE ~ NA_real_
    ),
    rating_cleanliness = case_when(
      rating_cleanliness >= 0 & rating_cleanliness <= 5 ~ rating_cleanliness,
      TRUE ~ NA_real_
    ),
    rating_location = case_when(
      rating_location >= 0 & rating_location <= 5 ~ rating_location,
      TRUE ~ NA_real_
    ),
    rating_value = case_when(
      rating_value >= 0 & rating_value <= 5 ~ rating_value,
      TRUE ~ NA_real_
    ),
    
    ttm_revenue = case_when(ttm_revenue >= 0 ~ ttm_revenue, TRUE ~ NA_real_),
    ttm_avg_rate = case_when(ttm_avg_rate >= 0 ~ ttm_avg_rate, TRUE ~ NA_real_),
    l90d_revenue = case_when(l90d_revenue >= 0 ~ l90d_revenue, TRUE ~ NA_real_),
    l90d_avg_rate = case_when(l90d_avg_rate >= 0 ~ l90d_avg_rate, TRUE ~ NA_real_),
    
    ttm_occupancy = case_when(
      ttm_occupancy >= 0 & ttm_occupancy <= 1 ~ ttm_occupancy,
      TRUE ~ NA_real_
    ),
    l90d_occupancy = case_when(
      l90d_occupancy >= 0 & l90d_occupancy <= 1 ~ l90d_occupancy,
      TRUE ~ NA_real_
    ),
    
    ttm_revpar = case_when(ttm_revpar >= 0 ~ ttm_revpar, TRUE ~ NA_real_),
    l90d_revpar = case_when(l90d_revpar >= 0 ~ l90d_revpar, TRUE ~ NA_real_),
    
    location_from_name = str_extract(str_to_lower(listing_name), "yerevan|armenia|erevan"),
    
    city_category = case_when(
      latitude >= 40.1 & latitude <= 40.2 & longitude >= 44.4 & longitude <= 44.6 ~ "Yerevan_area",
      !is.na(latitude) & !is.na(longitude) ~ "Other_Armenia",
      TRUE ~ "Unknown"
    )
  ) %>%
  filter(
    !is.na(listing_id),
    !is.na(latitude) & !is.na(longitude)
  )

cat("Final cleaned dataset dimensions:", dim(cleaned_data), "\n")
```


``` {r}
cat("Missing values summary:\n")
cleaned_data %>%
  summarise_all(~sum(is.na(.))) %>%
  gather(key = "column", value = "missing_count") %>%
  arrange(desc(missing_count)) %>%
  print()

cat("\nSummary statistics for key variables:\n")
summary(cleaned_data[c("guests", "bedrooms", "beds", "baths", "num_reviews", 
                       "rating_overall", "ttm_avg_rate", "l90d_avg_rate")])

```


```{r}
cat("First 10 rows of cleaned data:\n")
head(cleaned_data, 10) %>% print()

cat("\nUnique listing types:\n")
cleaned_data %>% count(listing_type, sort = TRUE) %>% print()

cat("\nUnique room types:\n")
cleaned_data %>% count(room_type, sort = TRUE) %>% print()

cat("\nLocation categories:\n")
cleaned_data %>% count(city_category, sort = TRUE) %>% print()

cat("\nLocation indicators from listing names:\n")
cleaned_data %>% 
  filter(!is.na(location_from_name)) %>% 
  count(location_from_name, sort = TRUE) %>% 
  print()
```

``` {r}
output_path= "/Users/alex/Desktop/R-project/cleaned_rental_data_from_Airbnb.csv"

write_csv(cleaned_data, output_path)

cat("Cleaned data exported to:", output_path, "\n")
cat("Final dataset contains", nrow(cleaned_data), "listings with", ncol(cleaned_data), "variables.\n")
```


